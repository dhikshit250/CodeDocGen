"use strict";(()=>{var e={};e.id=153,e.ids=[153],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},57147:e=>{e.exports=require("fs")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},41808:e=>{e.exports=require("net")},22037:e=>{e.exports=require("os")},4074:e=>{e.exports=require("perf_hooks")},63477:e=>{e.exports=require("querystring")},12781:e=>{e.exports=require("stream")},24404:e=>{e.exports=require("tls")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},79965:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>A,originalPathname:()=>y,patchFetch:()=>L,requestAsyncStorage:()=>_,routeModule:()=>N,serverHooks:()=>j,staticGenerationAsyncStorage:()=>h,staticGenerationBailout:()=>q});var a={};r.r(a),r.d(a,{GET:()=>m});var o=r(95419),s=r(69108),n=r(99678),d=r(78070),l=r(47033),i=r(12030),u=r(12393);function c(e){return u.i6`count(${e||u.i6.raw("*")})`.mapWith(Number)}function p(e){return u.i6`sum(${e})`.mapWith(String)}var f=r(12279),g=r(3205);async function m(e){try{let t;let r=await (0,g.I)();if(!r?.user?.id)return d.Z.json({error:"Unauthorized"},{status:401});let{searchParams:a}=new URL(e.url),o=a.get("period")||"month",s=a.get("startDate"),n=a.get("endDate"),u=new Date,m=u;if(s&&n)t=new Date(s),m=new Date(n);else switch(o){case"day":t=new Date(u.getTime()-864e5);break;case"week":t=new Date(u.getTime()-6048e5);break;case"month":t=new Date(u.getFullYear(),u.getMonth(),1);break;case"year":t=new Date(u.getFullYear(),0,1);break;default:t=new Date(u.getTime()-2592e6)}let N=await l.db.select({totalGenerations:c(i.ed.id),totalTokensUsed:p(i.ed.tokensUsed),totalCost:p(i.ed.cost),completedGenerations:c(i.ed.id).where((0,f.eq)(i.ed.status,"completed")),failedGenerations:c(i.ed.id).where((0,f.eq)(i.ed.status,"failed"))}).from(i.ed).where((0,f.xD)((0,f.eq)(i.ed.userId,r.user.id),(0,f.eg)(i.ed.createdAt,t),(0,f.G)(i.ed.createdAt,m))),_=await l.db.select({totalProjects:c(i.q.id),codeProjects:c(i.q.id).where((0,f.eq)(i.q.type,"code")),docsProjects:c(i.q.id).where((0,f.eq)(i.q.type,"docs")),bothProjects:c(i.q.id).where((0,f.eq)(i.q.type,"both"))}).from(i.q).where((0,f.xD)((0,f.eq)(i.q.userId,r.user.id),(0,f.eg)(i.q.createdAt,t),(0,f.G)(i.q.createdAt,m))),h=await l.db.select({date:i.j_.date,generations:p(i.j_.generations),tokensUsed:p(i.j_.tokensUsed),cost:p(i.j_.cost)}).from(i.j_).where((0,f.xD)((0,f.eq)(i.j_.userId,r.user.id),(0,f.eg)(i.j_.date,t.toISOString().split("T")[0]),(0,f.G)(i.j_.date,m.toISOString().split("T")[0]))).orderBy(i.j_.date),j=await l.db.select({language:i.q.language,count:c(i.q.id)}).from(i.q).where((0,f.xD)((0,f.eq)(i.q.userId,r.user.id),(0,f.eg)(i.q.createdAt,t),(0,f.G)(i.q.createdAt,m))).groupBy(i.q.language).orderBy(c(i.q.id)),A=N[0]||{totalGenerations:0,totalTokensUsed:0,totalCost:0,completedGenerations:0,failedGenerations:0},q=_[0]||{totalProjects:0,codeProjects:0,docsProjects:0,bothProjects:0};return d.Z.json({period:{start:t.toISOString(),end:m.toISOString(),type:o},usage:{totalGenerations:Number(A.totalGenerations)||0,totalTokensUsed:Number(A.totalTokensUsed)||0,totalCost:Number(A.totalCost)||0,completedGenerations:Number(A.completedGenerations)||0,failedGenerations:Number(A.failedGenerations)||0,successRate:A.totalGenerations>0?(Number(A.completedGenerations)/Number(A.totalGenerations)*100).toFixed(1):"0"},projects:{totalProjects:Number(q.totalProjects)||0,codeProjects:Number(q.codeProjects)||0,docsProjects:Number(q.docsProjects)||0,bothProjects:Number(q.bothProjects)||0},dailyUsage:h.map(e=>({date:e.date,generations:Number(e.generations)||0,tokensUsed:Number(e.tokensUsed)||0,cost:Number(e.cost)||0})),languageDistribution:j.map(e=>({language:e.language||"Unknown",count:Number(e.count)||0}))})}catch(e){return console.error("Get usage API error:",e),d.Z.json({error:"Internal server error"},{status:500})}}let N=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/usage/route",pathname:"/api/usage",filename:"route",bundlePath:"app/api/usage/route"},resolvedPagePath:"C:\\Users\\bunny\\CascadeProjects\\code-doc-gen\\app\\api\\usage\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:_,staticGenerationAsyncStorage:h,serverHooks:j,headerHooks:A,staticGenerationBailout:q}=N,y="/api/usage/route";function L(){return(0,n.patchFetch)({serverHooks:j,staticGenerationAsyncStorage:h})}},4118:(e,t,r)=>{r.r(t),r.d(t,{GET:()=>l,POST:()=>l,authOptions:()=>d});var a=r(81355),o=r.n(a),s=r(10375),n=r(79390);let d={providers:[(0,s.Z)({clientId:process.env.GOOGLE_CLIENT_ID||"",clientSecret:process.env.GOOGLE_CLIENT_SECRET||""}),(0,n.Z)({clientId:process.env.DISCORD_CLIENT_ID||"",clientSecret:process.env.DISCORD_CLIENT_SECRET||""})],callbacks:{session:async({session:e,token:t})=>(e.user.id=t.sub,e)},secret:process.env.NEXTAUTH_SECRET,pages:{signIn:"/login"}},l=o()(d)},3205:(e,t,r)=>{r.d(t,{I:()=>s});var a=r(49605),o=r(4118);async function s(){return await (0,a.getServerSession)(o.authOptions)}},47033:(e,t,r)=>{r.d(t,{db:()=>d});var a=r(37939),o=r(25669);let s=process.env.DATABASE_URL;if(!s)throw Error("DATABASE_URL is not set");let n=(0,o.Z)(s),d=(0,a.t)(n)},12030:(e,t,r)=>{r.d(t,{QZ:()=>g,ed:()=>m,j_:()=>_,q:()=>f,zd:()=>N});var a=r(96155),o=r(49703),s=r(81930),n=r(82561),d=r(56664),l=r(6402),i=r(70573),u=r(75887),c=r(42310);let p=(0,a.af)("users",{id:(0,o.Vj)("id").defaultRandom().primaryKey(),name:(0,s.L7)("name",{length:255}),email:(0,s.L7)("email",{length:255}).notNull().unique(),emailVerified:(0,n.AB)("email_verified"),image:(0,s.L7)("image",{length:255}),createdAt:(0,n.AB)("created_at").defaultNow().notNull(),updatedAt:(0,n.AB)("updated_at").defaultNow().notNull()});(0,a.af)("accounts",{id:(0,o.Vj)("id").defaultRandom().primaryKey(),userId:(0,o.Vj)("user_id").notNull().references(()=>p.id,{onDelete:"cascade"}),type:(0,s.L7)("type",{length:50}).notNull(),provider:(0,s.L7)("provider",{length:50}).notNull(),providerAccountId:(0,s.L7)("provider_account_id",{length:255}).notNull(),refresh_token:(0,d.fL)("refresh_token"),access_token:(0,d.fL)("access_token"),expires_at:(0,l._L)("expires_at"),token_type:(0,s.L7)("token_type",{length:50}),scope:(0,d.fL)("scope"),id_token:(0,d.fL)("id_token"),session_state:(0,d.fL)("session_state"),createdAt:(0,n.AB)("created_at").defaultNow().notNull(),updatedAt:(0,n.AB)("updated_at").defaultNow().notNull()}),(0,a.af)("sessions",{id:(0,o.Vj)("id").defaultRandom().primaryKey(),sessionToken:(0,s.L7)("session_token",{length:255}).notNull().unique(),userId:(0,o.Vj)("user_id").notNull().references(()=>p.id,{onDelete:"cascade"}),expires:(0,n.AB)("expires").notNull(),createdAt:(0,n.AB)("created_at").defaultNow().notNull(),updatedAt:(0,n.AB)("updated_at").defaultNow().notNull()});let f=(0,a.af)("projects",{id:(0,o.Vj)("id").defaultRandom().primaryKey(),userId:(0,o.Vj)("user_id").notNull().references(()=>p.id,{onDelete:"cascade"}),name:(0,s.L7)("name",{length:255}).notNull(),description:(0,d.fL)("description"),type:(0,s.L7)("type",{length:50}).notNull(),language:(0,s.L7)("language",{length:100}),framework:(0,s.L7)("framework",{length:100}),prompt:(0,d.fL)("prompt").notNull(),settings:(0,i.JB)("settings"),createdAt:(0,n.AB)("created_at").defaultNow().notNull(),updatedAt:(0,n.AB)("updated_at").defaultNow().notNull()}),g=(0,a.af)("files",{id:(0,o.Vj)("id").defaultRandom().primaryKey(),projectId:(0,o.Vj)("project_id").notNull().references(()=>f.id,{onDelete:"cascade"}),name:(0,s.L7)("name",{length:255}).notNull(),path:(0,s.L7)("path",{length:500}).notNull(),type:(0,s.L7)("type",{length:50}).notNull(),language:(0,s.L7)("language",{length:100}),content:(0,d.fL)("content").notNull(),size:(0,l._L)("size").notNull(),createdAt:(0,n.AB)("created_at").defaultNow().notNull(),updatedAt:(0,n.AB)("updated_at").defaultNow().notNull()}),m=(0,a.af)("generations",{id:(0,o.Vj)("id").defaultRandom().primaryKey(),userId:(0,o.Vj)("user_id").notNull().references(()=>p.id,{onDelete:"cascade"}),projectId:(0,o.Vj)("project_id").references(()=>f.id,{onDelete:"cascade"}),prompt:(0,d.fL)("prompt").notNull(),type:(0,s.L7)("type",{length:50}).notNull(),settings:(0,i.JB)("settings"),status:(0,s.L7)("status",{length:50}).notNull().default("pending"),tokensUsed:(0,l._L)("tokens_used").default(0),cost:(0,l._L)("cost").default(0),error:(0,d.fL)("error"),createdAt:(0,n.AB)("created_at").defaultNow().notNull(),updatedAt:(0,n.AB)("updated_at").defaultNow().notNull(),completedAt:(0,n.AB)("completed_at")}),N=(0,a.af)("templates",{id:(0,o.Vj)("id").defaultRandom().primaryKey(),name:(0,s.L7)("name",{length:255}).notNull(),description:(0,d.fL)("description"),category:(0,s.L7)("category",{length:100}).notNull(),language:(0,s.L7)("language",{length:100}),difficulty:(0,s.L7)("difficulty",{length:50}).notNull(),prompt:(0,d.fL)("prompt").notNull(),settings:(0,i.JB)("settings"),hasCode:(0,u.O7)("has_code").default(!0),hasDocs:(0,u.O7)("has_docs").default(!0),downloads:(0,l._L)("downloads").default(0),rating:(0,l._L)("rating").default(0),isPublic:(0,u.O7)("is_public").default(!0),isOfficial:(0,u.O7)("is_official").default(!1),createdBy:(0,o.Vj)("created_by").references(()=>p.id),createdAt:(0,n.AB)("created_at").defaultNow().notNull(),updatedAt:(0,n.AB)("updated_at").defaultNow().notNull()}),_=(0,a.af)("usage",{id:(0,o.Vj)("id").defaultRandom().primaryKey(),userId:(0,o.Vj)("user_id").notNull().references(()=>p.id,{onDelete:"cascade"}),date:(0,n.AB)("date").notNull(),generations:(0,l._L)("generations").default(0),tokensUsed:(0,l._L)("tokens_used").default(0),cost:(0,l._L)("cost").default(0),createdAt:(0,n.AB)("created_at").defaultNow().notNull(),updatedAt:(0,n.AB)("updated_at").defaultNow().notNull()});(0,c.fC)(p),(0,c.IO)(p),(0,c.fC)(f),(0,c.IO)(f),(0,c.fC)(g),(0,c.IO)(g),(0,c.fC)(m),(0,c.IO)(m),(0,c.fC)(N),(0,c.IO)(N),(0,c.fC)(_),(0,c.IO)(_)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[638,206,721,279,754],()=>r(79965));module.exports=a})();